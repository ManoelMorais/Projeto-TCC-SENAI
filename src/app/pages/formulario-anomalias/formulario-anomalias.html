<form [formGroup]="form" (ngSubmit)="submit()">
  <div>
    <label class="form-title">Formulário de Registro de Anomalias - (SIAA)</label>
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Data/Hora da Solicitação</label>
    <input formControlName="dataSolicitacao" type="datetime-local" readonly class="primary-field date_Solicitacao">
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Função/Equipe do Registrador *</label>
    <select formControlName="funcaoRegistrador" class="cxSelect">
      <option value="" disabled selected>Selecione a Função</option>
      <option *ngFor="let funcao of funcoesRegistrador" [value]="funcao" >{{ funcao }}</option>
    </select>
    <app-primary-input
      *ngIf="form.get('funcaoRegistrador')?.value === 'Outro'"
      formControlName="funcaoRegistradorOutro"
      label="Especifique a Função"
      placeholder="Especifique: Eletricista de CCO, etc."
      type="text">
    </app-primary-input>
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Tipo de Rede Afetada *</label>
    <select formControlName="tipoRedeAfetada" class="cxSelect">
      <option value="" disabled selected>Selecione o Tipo de Rede</option>
      <option *ngFor="let rede of tiposRede" [value]="rede" >{{ rede }}</option>
    </select>
    <app-primary-input
      *ngIf="form.get('tipoRedeAfetada')?.value === 'Outro'"
      formControlName="tipoRedeAfetadaOutro"
      label="Especifique a Rede Afetada"
      placeholder="Ex: Rede Interna, Iluminação Pública"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Ativo/Identificação da Estrutura Mais Próxima</label>
    <app-primary-input
      formControlName="identificacaoEstrutura"
      placeholder="Ex: Número do Poste, Torre ou Subestação"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Chave Abrangência ou Ponto Significativo</label>
    <app-primary-input
      formControlName="chaveAbrangencia"
      inputName="chaveAbrangencia"
      placeholder="Digite a chave ou ponto"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Alimentador</label>
    <app-primary-input
    formControlName="alimentador"
    inputName="alimentador"
    placeholder="Informe o alimentador"
    type="text">
  </app-primary-input>
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Tipo de Anomalia (Classificação Primária) *</label>
    <select formControlName="tipoAnomalia" class="cxSelect">
      <option value="" disabled selected>Selecione a Classificação</option>
      <option *ngFor="let tipo of tiposAnomalia" [value]="tipo" >{{ tipo }}</option>
    </select>
    <app-primary-input
      *ngIf="form.get('tipoAnomalia')?.value === 'Outro'"
      formControlName="tipoAnomaliaOutro"
      label="Especifique a Anomalia"
      placeholder="Especifique o tipo de anomalia"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Componente/Equipamento Específico Afetado *</label>
    <select formControlName="componenteAfetado" class="cxSelect">
      <option value="" disabled selected>Selecione o Componente</option>
      <option *ngFor="let comp of componentesAfetados" [value]="comp" >{{ comp }}</option>
    </select>
    <app-primary-input
      *ngIf="form.get('componenteAfetado')?.value === 'Outro'"
      formControlName="componenteAfetadoOutro"
      label="Especifique o Componente"
      placeholder="Especifique o componente afetado"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Gravidade/Urgência da Situação *</label>
    <div *ngFor="let gravidade of criticidades"> <input type="radio" [value]="gravidade" formControlName="criticidade" id="criticidade-{{gravidade}}">
      <label for="criticidade-{{gravidade}}">{{ gravidade }}</label>
    </div>
  </div>

  <div class="form-group">
    <label>Há Interrupção de Energia Associada? *</label>
    <div *ngFor="let interr of tiposInterrupcao">
      <input
        type="radio"
        [value]="interr"
        formControlName="interrupcao">
      <label>{{ interr }}</label>
    </div>
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Classificação do serviço *</label>
    <div *ngFor="let item of classificacoes">
      <input type="radio" [value]="item" formControlName="classificacao" id="classificacao-{{item}}">
      <label for="classificacao-{{item}}">{{ item }}</label>
    </div>
  </div>

  <div class="form-group">
    <label>Departamento Responsável</label>
    <div *ngFor="let dep of departamentos">
      <input type="radio" [value]="dep" formControlName="departamento" id="departamento-{{dep}}">
      <label for="departamento-{{dep}}">{{ dep }}</label>
    </div>
  </div>

  <div class="form-group">
    <label>Condição de Acesso ao Local *</label>
    <select formControlName="condicaoAcesso" class="cxSelect">
      <option value="" disabled selected>Selecione a Condição</option>
      <option *ngFor="let acesso of condicoesAcesso" [value]="acesso" >{{ acesso }}</option>
    </select>
  </div>

  <div class="form-group">
    <label>A equipe tomou alguma Ação Mitigadora Imediata? *</label>
    <div *ngFor="let acao of acoesMitigadoras; let i = index" class="radio-row">
      <input type="radio" [value]="acao" formControlName="acaoMitigadora" id="acaoMitigadora-{{i}}">
      <label for="acaoMitigadora-{{i}}">{{ acao }}</label>
    </div>

    <textarea *ngIf="form.get('acaoMitigadora')?.value?.includes('Sim')"
      formControlName="qualAcaoMitigadora"
      placeholder="Se sim, qual ação foi tomada? (Ex: Sinalização, Isolamento da área)">
    </textarea>
  </div>

  <div class="divisor"></div>

  <div class="form-group">
    <label>Descrição Detalhada da Anomalia *</label>
    <textarea formControlName="observacoes" placeholder="Insira uma descrição breve e objetiva, focando nos detalhes do problema"></textarea>
  </div>

  <div class="form-group">
    <label>Causa Provável da Anomalia (Opinião do Registrador)</label>
    <select formControlName="causaProvavel" class="cxSelect">
      <option value="" disabled selected>Selecione a Causa Provável</option>
      <option *ngFor="let causa of causasProvaveis" [value]="causa">{{ causa }}</option>
    </select>
    <app-primary-input
      *ngIf="form.get('causaProvavel')?.value === 'Outro'"
      formControlName="causaProvavelOutro"
      label="Especifique a Causa"
      placeholder="Especifique a causa provável"
      type="text">
    </app-primary-input>
  </div>

  <div class="form-group">
    <label>Observações Adicionais para a Equipe de Resposta</label>
    <textarea formControlName="observacoesAdicionais" placeholder="Detalhes extras, como contato local, perigos não listados, etc."></textarea>
  </div>

  <div class="form-group">
    <label>Adicionar Fotos da Anomalia/Local</label>
    <input class="primary-field" type="file" (change)="onFileSelected($event)" multiple accept="image/*,video/*">
    <div *ngIf="arquivos.length > 0" class="file-list">
      <p *ngFor="let file of arquivos">{{ file.name }}</p>
    </div>
  </div>

  <app-map></app-map>

  <div class="form-actions">
    <button type="submit" [disabled]="form.invalid" [class.active]="form.valid">Enviar</button>
    <button type="button" (click)="voltar()">Voltar</button>
  </div>

  <div class="modal-overlay" *ngIf="showSuccess">
    <div class="modal">
      <h3>Solicitação concluída</h3>
      <p>Sua solicitação foi enviada com sucesso. Em breve a equipe responsável irá avaliar.</p>
      <div class="modal-actions">
        <button type="button" (click)="goToSolicitacoes()">Ir para Solicitações</button>
        <button type="button" class="secondary" (click)="closeModal()">Fechar</button>
      </div>
    </div>
  </div>

</form>
